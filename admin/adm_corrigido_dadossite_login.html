
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Ola Carlópolis</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js">
function carregarListaCompleta() {
  const grupos = ["comercios", "servicos"];
  const tabela = document.getElementById("tabelaEstabelecimentos");
  tabela.innerHTML = "";

  grupos.forEach(grupo => {
    firebase.database().ref("dadosSite/" + grupo).once("value").then(snapshot => {
      const categorias = snapshot.val();
      for (const categoria in categorias) {
        for (const id in categorias[categoria]) {
          const est = categorias[categoria][id];
          const linha = document.createElement("tr");
          linha.innerHTML = `
            <td>${est.nome || id}</td>
            <td>${grupo}</td>
            <td>${categoria}</td>
            <td><button onclick="editarEstabelecimento('${grupo}','${categoria}','${id}')">Editar</button></td>
          `;
          tabela.appendChild(linha);
        }
      }
    });
  });
}

function editarEstabelecimento(grupo, categoria, id) {
  document.getElementById("grupoSelect").value = grupo;
  carregarCategorias(() => {
    document.getElementById("categoriaSelect").value = categoria;
    carregarEstabelecimentos(() => {
      document.getElementById("estabelecimentoSelect").value = id;
      carregarDadosEstabelecimento();
      window.scrollTo(0, 0);
    });
  });
}


let userEmail = "";

function criarEstabelecimento() {
  const grupo = document.getElementById("novoGrupo").value;
  const categoria = document.getElementById("novaCategoria").value.trim();
  const id = document.getElementById("novoID").value.trim();
  const nome = document.getElementById("novoNome").value.trim();

  if (!grupo || !categoria || !id || !nome) {
    alert("Preencha todos os campos para criar.");
    return;
  }

  const ref = firebase.database().ref(`dadosSite/${grupo}/${categoria}/${id}`);
  ref.set({
    nome: nome,
    endereco: "",
    telefone: "",
    horario: "",
    entrega: "Não",
    taxaEntrega: "Não",
    redesSociais: {
      instagram: "",
      facebook: "",
      site: ""
    },
    infoAdicional: "",
    vagaTrabalho: "",
    dataEvento: "",
    plantaoHorario: "",
    plantaoData: "",
    novidades: { imagens: [] },
    cardapio: []
  }).then(() => {
    alert("Estabelecimento criado!");
    carregarCategorias();
    carregarListaCompleta();
    document.getElementById("novoEstabelecimentoBox").classList.add("hidden");
  });
}

</script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js">
function carregarListaCompleta() {
  const grupos = ["comercios", "servicos"];
  const tabela = document.getElementById("tabelaEstabelecimentos");
  tabela.innerHTML = "";

  grupos.forEach(grupo => {
    firebase.database().ref("dadosSite/" + grupo).once("value").then(snapshot => {
      const categorias = snapshot.val();
      for (const categoria in categorias) {
        for (const id in categorias[categoria]) {
          const est = categorias[categoria][id];
          const linha = document.createElement("tr");
          linha.innerHTML = `
            <td>${est.nome || id}</td>
            <td>${grupo}</td>
            <td>${categoria}</td>
            <td><button onclick="editarEstabelecimento('${grupo}','${categoria}','${id}')">Editar</button></td>
          `;
          tabela.appendChild(linha);
        }
      }
    });
  });
}

function editarEstabelecimento(grupo, categoria, id) {
  document.getElementById("grupoSelect").value = grupo;
  carregarCategorias(() => {
    document.getElementById("categoriaSelect").value = categoria;
    carregarEstabelecimentos(() => {
      document.getElementById("estabelecimentoSelect").value = id;
      carregarDadosEstabelecimento();
      window.scrollTo(0, 0);
    });
  });
}


let userEmail = "";

function criarEstabelecimento() {
  const grupo = document.getElementById("novoGrupo").value;
  const categoria = document.getElementById("novaCategoria").value.trim();
  const id = document.getElementById("novoID").value.trim();
  const nome = document.getElementById("novoNome").value.trim();

  if (!grupo || !categoria || !id || !nome) {
    alert("Preencha todos os campos para criar.");
    return;
  }

  const ref = firebase.database().ref(`dadosSite/${grupo}/${categoria}/${id}`);
  ref.set({
    nome: nome,
    endereco: "",
    telefone: "",
    horario: "",
    entrega: "Não",
    taxaEntrega: "Não",
    redesSociais: {
      instagram: "",
      facebook: "",
      site: ""
    },
    infoAdicional: "",
    vagaTrabalho: "",
    dataEvento: "",
    plantaoHorario: "",
    plantaoData: "",
    novidades: { imagens: [] },
    cardapio: []
  }).then(() => {
    alert("Estabelecimento criado!");
    carregarCategorias();
    carregarListaCompleta();
    document.getElementById("novoEstabelecimentoBox").classList.add("hidden");
  });
}

</script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js">
function carregarListaCompleta() {
  const grupos = ["comercios", "servicos"];
  const tabela = document.getElementById("tabelaEstabelecimentos");
  tabela.innerHTML = "";

  grupos.forEach(grupo => {
    firebase.database().ref("dadosSite/" + grupo).once("value").then(snapshot => {
      const categorias = snapshot.val();
      for (const categoria in categorias) {
        for (const id in categorias[categoria]) {
          const est = categorias[categoria][id];
          const linha = document.createElement("tr");
          linha.innerHTML = `
            <td>${est.nome || id}</td>
            <td>${grupo}</td>
            <td>${categoria}</td>
            <td><button onclick="editarEstabelecimento('${grupo}','${categoria}','${id}')">Editar</button></td>
          `;
          tabela.appendChild(linha);
        }
      }
    });
  });
}

function editarEstabelecimento(grupo, categoria, id) {
  document.getElementById("grupoSelect").value = grupo;
  carregarCategorias(() => {
    document.getElementById("categoriaSelect").value = categoria;
    carregarEstabelecimentos(() => {
      document.getElementById("estabelecimentoSelect").value = id;
      carregarDadosEstabelecimento();
      window.scrollTo(0, 0);
    });
  });
}


let userEmail = "";

function criarEstabelecimento() {
  const grupo = document.getElementById("novoGrupo").value;
  const categoria = document.getElementById("novaCategoria").value.trim();
  const id = document.getElementById("novoID").value.trim();
  const nome = document.getElementById("novoNome").value.trim();

  if (!grupo || !categoria || !id || !nome) {
    alert("Preencha todos os campos para criar.");
    return;
  }

  const ref = firebase.database().ref(`dadosSite/${grupo}/${categoria}/${id}`);
  ref.set({
    nome: nome,
    endereco: "",
    telefone: "",
    horario: "",
    entrega: "Não",
    taxaEntrega: "Não",
    redesSociais: {
      instagram: "",
      facebook: "",
      site: ""
    },
    infoAdicional: "",
    vagaTrabalho: "",
    dataEvento: "",
    plantaoHorario: "",
    plantaoData: "",
    novidades: { imagens: [] },
    cardapio: []
  }).then(() => {
    alert("Estabelecimento criado!");
    carregarCategorias();
    carregarListaCompleta();
    document.getElementById("novoEstabelecimentoBox").classList.add("hidden");
  });
}

</script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js">
function carregarListaCompleta() {
  const grupos = ["comercios", "servicos"];
  const tabela = document.getElementById("tabelaEstabelecimentos");
  tabela.innerHTML = "";

  grupos.forEach(grupo => {
    firebase.database().ref("dadosSite/" + grupo).once("value").then(snapshot => {
      const categorias = snapshot.val();
      for (const categoria in categorias) {
        for (const id in categorias[categoria]) {
          const est = categorias[categoria][id];
          const linha = document.createElement("tr");
          linha.innerHTML = `
            <td>${est.nome || id}</td>
            <td>${grupo}</td>
            <td>${categoria}</td>
            <td><button onclick="editarEstabelecimento('${grupo}','${categoria}','${id}')">Editar</button></td>
          `;
          tabela.appendChild(linha);
        }
      }
    });
  });
}

function editarEstabelecimento(grupo, categoria, id) {
  document.getElementById("grupoSelect").value = grupo;
  carregarCategorias(() => {
    document.getElementById("categoriaSelect").value = categoria;
    carregarEstabelecimentos(() => {
      document.getElementById("estabelecimentoSelect").value = id;
      carregarDadosEstabelecimento();
      window.scrollTo(0, 0);
    });
  });
}


let userEmail = "";

function criarEstabelecimento() {
  const grupo = document.getElementById("novoGrupo").value;
  const categoria = document.getElementById("novaCategoria").value.trim();
  const id = document.getElementById("novoID").value.trim();
  const nome = document.getElementById("novoNome").value.trim();

  if (!grupo || !categoria || !id || !nome) {
    alert("Preencha todos os campos para criar.");
    return;
  }

  const ref = firebase.database().ref(`dadosSite/${grupo}/${categoria}/${id}`);
  ref.set({
    nome: nome,
    endereco: "",
    telefone: "",
    horario: "",
    entrega: "Não",
    taxaEntrega: "Não",
    redesSociais: {
      instagram: "",
      facebook: "",
      site: ""
    },
    infoAdicional: "",
    vagaTrabalho: "",
    dataEvento: "",
    plantaoHorario: "",
    plantaoData: "",
    novidades: { imagens: [] },
    cardapio: []
  }).then(() => {
    alert("Estabelecimento criado!");
    carregarCategorias();
    carregarListaCompleta();
    document.getElementById("novoEstabelecimentoBox").classList.add("hidden");
  });
}

</script>
  

<style>
  body {
    font-family: 'Poppins', sans-serif;
    margin: 0;
    background-color: #121212;
    color: #fff;
  }
  h2, h3 {
    color: #ffffff;
    margin: 20px;
  }
  input, select, textarea, button {
    margin: 8px 0;
    padding: 10px;
    width: 100%;
    max-width: 100%;
    border-radius: 8px;
    border: 1px solid #333;
    background: #1e1e1e;
    color: #fff;
    outline: none;
    transition: all 0.2s ease-in-out;
  }
  input:focus, select:focus, textarea:focus {
    border-color: #4070f4;
    box-shadow: 0 0 5px #4070f4;
  }
  button {
    background-color: #4070f4;
    border: none;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s;
  }
  button:hover {
    background-color: #3056c9;
    transform: scale(1.02);
  }
  label {
    margin-top: 10px;
    display: block;
    font-weight: 500;
    color: #ccc;
  }
  .hidden { display: none; }
  .preview img {
    max-width: 100px;
    margin: 5px;
    border-radius: 6px;
    border: 1px solid #333;
  }
  .card {
    background-color: #1a1a1a;
    padding: 20px;
    margin: 20px auto;
    border-radius: 12px;
    box-shadow: 0 0 10px #00000050;
    max-width: 800px;
  }
  .card h3::before {
    font-family: "Font Awesome 6 Free";
    font-weight: 900;
    content: "044";
    margin-right: 10px;
    color: #4070f4;
  }
  #listaEstabelecimentos h3::before {
    content: "03a";
  }
  table {
    background: #1a1a1a;
    border-collapse: collapse;
    margin: 20px auto;
    width: 95%;
    border-radius: 12px;
    overflow: hidden;
  }
  th, td {
    padding: 12px;
    border: 1px solid #2c2c2c;
    color: #ddd;
    text-align: left;
  }
  th {
    background-color: #222;
  }

  @media (max-width: 600px) {
    body { padding: 10px; }
    .card { margin: 10px; padding: 15px; }
    input, select, textarea, button {
      font-size: 16px;
    }
    table, thead, tbody, th, td, tr {
      display: block;
    }
    thead tr {
      display: none;
    }
    td {
      position: relative;
      padding-left: 50%;
      border: none;
      border-bottom: 1px solid #333;
    }
    td::before {
      position: absolute;
      top: 12px;
      left: 10px;
      width: 45%;
      white-space: nowrap;
      font-weight: bold;
      color: #888;
    }
    td:nth-of-type(1)::before { content: "Nome"; }
    td:nth-of-type(2)::before { content: "Grupo"; }
    td:nth-of-type(3)::before { content: "Categoria"; }
    td:nth-of-type(4)::before { content: "Ações"; }
  }
</style>


</head>
<body style='padding: 20px;'>

  <h2>Área Administrativa</h2>

  <div id="loginBox">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="senha" placeholder="Senha">
    <button onclick="login()">Entrar</button>
  </div>

  <div class="card hidden" id="painel">
<h3>Gerenciamento de Estabelecimentos</h3>
    <label>Grupo:</label>
    <select id="grupoSelect" onchange="carregarCategorias()">
      <option value="comercios">Comércios</option>
      <option value="servicos">Serviços</option>
      <option value="setorPublico">Setor Público</option>
      <option value="informacoesUteis">Informações Úteis</option>
    </select>
	


    <label>Categoria:</label>
    <select id="categoriaSelect" onchange="carregarEstabelecimentos()"></select>

    <label>Estabelecimento:</label>
    <select id="estabelecimentoSelect" onchange="carregarDadosEstabelecimento()"></select>

    <label>Nome:</label>
    <input type="text" id="nome">
    <label>Endereço:</label>
    <input type="text" id="endereco">
    <label>Telefone:</label>
    <input type="text" id="telefone">
    <label>Horário de funcionamento:</label>
    <textarea id="horario"></textarea>
    <label>Entrega?</label>
    <select id="entrega">
      <option value="Sim">Sim</option>
      <option value="Não">Não</option>
    </select>
    <label>Taxa de Entrega?</label>
    <select id="taxaEntrega">
      <option value="Sim">Sim</option>
      <option value="Não">Não</option>
    </select>
    <label>Instagram:</label>
    <input type="text" id="instagram">
    <label>Facebook:</label>
    <input type="text" id="facebook">
    <label>Site:</label>
    <input type="text" id="site">
    <label>Informações adicionais:</label>
    <textarea id="infoAdicional"></textarea>
    <label>Vaga de trabalho:</label>
    <input type="text" id="vagaTrabalho">
    <label>Data do evento:</label>
    <input type="date" id="dataEvento">
    <label>Horário do plantão:</label>
    <input type="text" id="plantaoHorario">
    <label>Data do plantão:</label>
    <input type="date" id="plantaoData">

    <label>Imagens de Divulgação:</label>
    <input type="file" id="divulgacaoInput" multiple>
    <div class="preview" id="previewDivulgacao"></div>

    <label>Imagens de Cardápio:</label>
    <input type="file" id="cardapioInput" multiple>
    <div class="preview" id="previewCardapio"></div>

    <button onclick="enviarTudo()">Salvar Alterações</button>
  </div>

  
<script>
  const firebaseConfig = {
     apiKey: "AIzaSyDWHsZSHwVFpD88ChUywjw_GdZPifdrRGI",
    authDomain: "contadoracessos.firebaseapp.com",
    databaseURL: "https://contadoracessos-default-rtdb.firebaseio.com",
    projectId: "contadoracessos",
    storageBucket: "contadoracessos.firebasestorage.app",
    messagingSenderId: "521517291315",
    appId: "1:521517291315:web:74f8d878d2d8769460d046",
    measurementId: "G-BXPWYWK61F"
  };
  firebase.initializeApp(firebaseConfig);

  function login() {
    const email = document.getElementById("email").value;
    const senha = document.getElementById("senha").value;
    firebase.auth().signInWithEmailAndPassword(email, senha)
  .then((userCred) => {
    const user = userCred.user;
    if (user.email !== "admin@olacarlopolis.com") {
      alert("Acesso restrito ao administrador.");
      firebase.auth().signOut();
      return;
    }
    document.getElementById("loginBox").classList.add("hidden");
    document.getElementById("painel").classList.remove("hidden");
    carregarCategorias(); document.getElementById('listaEstabelecimentos').classList.remove('hidden'); carregarListaCompleta();
  })

      .catch(err => alert("Erro ao logar: " + err.message));
  }

  function carregarCategorias(callback) {
    const grupo = document.getElementById("grupoSelect").value;
    firebase.database().ref("dadosSite/" + grupo).once("value").then(snapshot => {
      const categorias = snapshot.val();
      const catSelect = document.getElementById("categoriaSelect");
      catSelect.innerHTML = "";
      for (const nome in categorias) {
        const opt = document.createElement("option");
        opt.value = nome;
        opt.innerText = nome;
        catSelect.appendChild(opt);
      }
      carregarEstabelecimentos(callback);
    });
  }

  function carregarEstabelecimentos(callback) {
    const grupo = document.getElementById("grupoSelect").value;
    const categoria = document.getElementById("categoriaSelect").value;
    firebase.database().ref(`dadosSite/${grupo}/${categoria}`).once("value").then(snapshot => {
      const estabs = snapshot.val();
      const estSelect = document.getElementById("estabelecimentoSelect");
      estSelect.innerHTML = "";
      for (const id in estabs) {
        const opt = document.createElement("option");
        opt.value = id;
        opt.innerText = estabs[id].nome || id;
        estSelect.appendChild(opt);
      }
      carregarDadosEstabelecimento(); if (callback) callback();
    });
  }

  function carregarDadosEstabelecimento() {
    const grupo = document.getElementById("grupoSelect").value;
    const categoria = document.getElementById("categoriaSelect").value;
    const id = document.getElementById("estabelecimentoSelect").value;
    firebase.database().ref(`dadosSite/${grupo}/${categoria}/${id}`).once("value").then(snapshot => {
      const e = snapshot.val();
      if (!e) return;
      document.getElementById("nome").value = e.nome || "";
      document.getElementById("endereco").value = e.endereco || "";
      document.getElementById("telefone").value = e.telefone || "";
      document.getElementById("horario").value = e.horario || "";
      document.getElementById("entrega").value = e.entrega || "Não";
      document.getElementById("taxaEntrega").value = e.taxaEntrega || "Não";
      document.getElementById("instagram").value = e.redesSociais?.instagram || "";
      document.getElementById("facebook").value = e.redesSociais?.facebook || "";
      document.getElementById("site").value = e.redesSociais?.site || "";
      document.getElementById("infoAdicional").value = e.infoAdicional || "";
      document.getElementById("vagaTrabalho").value = e.vagaTrabalho || "";
      document.getElementById("dataEvento").value = e.dataEvento || "";
      document.getElementById("plantaoHorario").value = e.plantaoHorario || "";
      document.getElementById("plantaoData").value = e.plantaoData || "";
    });
  }

  function enviarTudo() {
    const grupo = document.getElementById("grupoSelect").value;
    const categoria = document.getElementById("categoriaSelect").value;
    const id = document.getElementById("estabelecimentoSelect").value;
    const storageRef = firebase.storage().ref();

    const obj = {
      nome: document.getElementById("nome").value,
      endereco: document.getElementById("endereco").value,
      telefone: document.getElementById("telefone").value,
      horario: document.getElementById("horario").value,
      entrega: document.getElementById("entrega").value,
      taxaEntrega: document.getElementById("taxaEntrega").value,
      redesSociais: {
        instagram: document.getElementById("instagram").value,
        facebook: document.getElementById("facebook").value,
        site: document.getElementById("site").value,
      },
      infoAdicional: document.getElementById("infoAdicional").value,
      vagaTrabalho: document.getElementById("vagaTrabalho").value,
      dataEvento: document.getElementById("dataEvento").value,
      plantaoHorario: document.getElementById("plantaoHorario").value,
      plantaoData: document.getElementById("plantaoData").value
    };

    const filesDiv = document.getElementById("divulgacaoInput").files;
    const filesCard = document.getElementById("cardapioInput").files;
    const divLinks = [], cardLinks = [], promises = [];

    for (let f of filesDiv) {
      const ref = storageRef.child(`divulgacao/${id}/${f.name}`);
      promises.push(ref.put(f).then(snap => snap.ref.getDownloadURL().then(url => divLinks.push(url))));
    }
    for (let f of filesCard) {
      const ref = storageRef.child(`cardapio/${id}/${f.name}`);
      promises.push(ref.put(f).then(snap => snap.ref.getDownloadURL().then(url => cardLinks.push(url))));
    }

    Promise.all(promises).then(() => {
      obj.novidades = { imagens: divLinks };
      obj.cardapio = cardLinks;
      firebase.database().ref(`dadosSite/${grupo}/${categoria}/${id}`).update(obj).then(() => {
        alert("Dados atualizados com sucesso!");
      });
    });
  }

function carregarListaCompleta() {
  const grupos = ["comercios", "servicos"];
  const tabela = document.getElementById("tabelaEstabelecimentos");
  tabela.innerHTML = "";

  grupos.forEach(grupo => {
    firebase.database().ref("dadosSite/" + grupo).once("value").then(snapshot => {
      const categorias = snapshot.val();
      for (const categoria in categorias) {
        for (const id in categorias[categoria]) {
          const est = categorias[categoria][id];
          const linha = document.createElement("tr");
          linha.innerHTML = `
            <td>${est.nome || id}</td>
            <td>${grupo}</td>
            <td>${categoria}</td>
            <td><button onclick="editarEstabelecimento('${grupo}','${categoria}','${id}')">Editar</button></td>
          `;
          tabela.appendChild(linha);
        }
      }
    });
  });
}

function editarEstabelecimento(grupo, categoria, id) {
  document.getElementById("grupoSelect").value = grupo;
  carregarCategorias(() => {
    document.getElementById("categoriaSelect").value = categoria;
    carregarEstabelecimentos(() => {
      document.getElementById("estabelecimentoSelect").value = id;
      carregarDadosEstabelecimento();
      window.scrollTo(0, 0);
    });
  });
}


let userEmail = "";

function criarEstabelecimento() {
  const grupo = document.getElementById("novoGrupo").value;
  const categoria = document.getElementById("novaCategoria").value.trim();
  const id = document.getElementById("novoID").value.trim();
  const nome = document.getElementById("novoNome").value.trim();

  if (!grupo || !categoria || !id || !nome) {
    alert("Preencha todos os campos para criar.");
    return;
  }

  const ref = firebase.database().ref(`dadosSite/${grupo}/${categoria}/${id}`);
  ref.set({
    nome: nome,
    endereco: "",
    telefone: "",
    horario: "",
    entrega: "Não",
    taxaEntrega: "Não",
    redesSociais: {
      instagram: "",
      facebook: "",
      site: ""
    },
    infoAdicional: "",
    vagaTrabalho: "",
    dataEvento: "",
    plantaoHorario: "",
    plantaoData: "",
    novidades: { imagens: [] },
    cardapio: []
  }).then(() => {
    alert("Estabelecimento criado!");
    carregarCategorias();
    carregarListaCompleta();
    document.getElementById("novoEstabelecimentoBox").classList.add("hidden");
  });
}

</script>
</body>
</html>
