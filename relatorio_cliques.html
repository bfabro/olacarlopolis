<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Relatório de Cliques por Categoria</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
</head>
<body>
  <div class="container">
    <h1>Relatório de Cliques por Categoria</h1>

    <label for="data">Selecione a data:</label>
    <input type="date" id="data" />
    <button onclick="buscarCliques()">Buscar</button>

    <h2>Total por Categoria</h2>
    <table border="1">
      <thead>
        <tr>
          <th>Categoria</th>
          <th>Qtd. Cliques</th>
        </tr>
      </thead>
      <tbody id="tabelaResumo"></tbody>
    </table>

    <h2>Ranking</h2>
    <ol id="ranking"></ol>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDWHsZSHwVFpD88ChUywjw_GdZPifdrRGI",
      authDomain: "contadoracessos.firebaseapp.com",
      databaseURL: "https://contadoracessos-default-rtdb.firebaseio.com",
      projectId: "contadoracessos",
      storageBucket: "contadoracessos.appspot.com",
      messagingSenderId: "521517291315",
      appId: "1:521517291315:web:74f8d878d2d8769460d046",
      measurementId: "G-BXPWYWK61F"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function buscarCliques() {
      const dataSelecionada = document.getElementById("data").value;
      if (!dataSelecionada) return alert("Selecione uma data!");

      const dataFormatada = new Date(dataSelecionada).toLocaleDateString("pt-BR");
      const ref = db.ref("cliquesPorMenu/" + dataFormatada);

      ref.once("value").then(snapshot => {
        const dados = snapshot.val();
        const resumo = document.getElementById("tabelaResumo");
        const ranking = document.getElementById("ranking");
        resumo.innerHTML = "";
        ranking.innerHTML = "";

        if (!dados) {
          resumo.innerHTML = `<tr><td colspan="2">Nenhum dado encontrado</td></tr>`;
          return;
        }

        const lista = Object.entries(dados).map(([categoria, total]) => ({ categoria, total }));

        lista.forEach(item => {
          const row = `<tr><td>${item.categoria}</td><td>${item.total}</td></tr>`;
          resumo.innerHTML += row;
        });

        lista.sort((a, b) => b.total - a.total);
        lista.forEach(item => {
          ranking.innerHTML += `<li>${item.categoria} - ${item.total} cliques</li>`;